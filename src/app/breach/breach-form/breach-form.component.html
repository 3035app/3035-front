<section class="breach-section">
  <header autoscroll="true" class="breach-entryContentBlock-header {{ currentSection.name }}">
    <div>
      <div class="">
          <i class="fa fa-pencil-square-o ng-star-inserted"></i>
      </div>
    </div>
    <div class="breach-entryContentBlock-header-title">
      <h1>Déclaration de violation</h1>
      <h3>{{ currentSection.short_help | translate }}</h3>
    </div>
    <ng-template #defaultBlock>
      <a routerLink="/summary/{{breach.id}}" class="btn breach-previewBlock">
        <span class="breach-icons breach-icon-preview"></span>
        <div>{{ 'breach.header.preview' | translate }}</div>
      </a>
    </ng-template>
  </header>
  <main>

    <form id="breach-form" #breachForm="ngForm">
      <fieldset *ngIf="currentSection.id == 1" id="description" class="form-section">
          <div class="form-field">
            <div>
                <label class="title" for="breach-time">Date et heure de la violation</label>
            </div>
            <div>
                <input type="text" name="" id="">
                <input type="text" name="" id="">
            </div>

            <div>
                <label class="title" for="breach-time">Date et heure de la constatation</label>
            </div>
            <div>
                <input type="text" name="" id="">
                <input type="text" name="" id="">
            </div>
        </div>
        <div class="form-field">
            <label class="title" for="identification-sensitive">Type de violation</label>
            <div class="type-sensitive">
              <div>
                <input type="checkbox"
                (change)="updateValue('identification')">
                <label class="label" for="identification-sensitive">Perte de confidentialité (accès non désiré)</label>
              </div>
              <div>
                <input type="checkbox"
                (change)="updateValue('identification')">
                <label class="label" for="identification-sensitive">Perte d'intégrité (modificatio non désirée)</label>
              </div>
              <div>
                  <input type="checkbox"
                  (change)="updateValue('identification')">
                  <label class="label" for="identification-sensitive">Perte de disponibilité (modification non désirée)</label>
                </div>
            </div>
        </div>
        <div class="form-field">
          <label class="title" for="processing-data-types">Nature et teneur des données concernées</label>
          <app-processing-data-types
            name="data-types"
            [processingId]=""
          ></app-processing-data-types>
        </div>
      </fieldset>

      <fieldset *ngIf="currentSection.id == 2" id="lifecycle" class="form-section">
          <div class="form-field">
            <label class="title" for="breach-lifecycle">{{ 'breach.form.lifecycle.title' | translate }}</label>
            <div (click)="editField(lifecycle, ['PIA_LGL_LFC'])"
              class="pia-questionBlock-contentText"
              [innerHTML]="breachForm.form.controls['lifecycle']?.value | safeHtml"
              [ngClass]="{ 'hide': ((editor && elementId === lifecycle.id) || !breachForm.form.controls['lifecycle']?.value) }"
            ></div>

            <textarea
              class="field"
              id="breach-lifecycle"
              required
              name="lifecycle"
              minRows="8"
              cols="50"
              placeholder="{{'breach.form.lifecycle.placeholder' | translate}}"
              #lifecycle
              (change)="updateBreach()"
              [(ngModel)]="breach.life_cycle"
              [ngClass]="{ 'hide': (breachForm.form.controls['lifecycle']?.value && breachForm.form.controls['lifecycle']?.value.length > 0) }"
              (focusin)="editField($event.target, ['PIA_LGL_LFC'])"
            ></textarea>
          </div>
          <div class="form-field">
            <label class="title" for="breach-processors">{{ 'breach.form.processors.title' | translate }}</label>
            <div (click)="editField(processors, ['PIA_LGL_ST', 'PIA_LGL_DEST'])"
              class="pia-questionBlock-contentText"
              [innerHTML]="breachForm.form.controls['processors']?.value | safeHtml"
              [ngClass]="{ 'hide': ((editor && elementId === processors.id) || !breachForm.form.controls['processors']?.value) }"
            ></div>

            <textarea
              class="field"
              id="breach-processors"
              required
              name="processors"
              minRows="8"
              cols="50"
              placeholder="{{'breach.form.processors.placeholder' | translate}}"
              #processors
              (change)="updateBreach()"
              [(ngModel)]="breach.processors"
              [ngClass]="{ 'hide': (breachForm.form.controls['processors']?.value && breachForm.form.controls['processors']?.value.length > 0) }"
              (focusin)="editField($event.target, ['PIA_LGL_ST', 'PIA_LGL_DEST'])"
            ></textarea>
          </div>
          <div class="form-field">
            <label class="title" for="breach-recipients">{{ 'breach.form.recipients.title' | translate }}</label>
            <div (click)="editField(recipients, ['PIA_LGL_ST', 'PIA_LGL_DEST'])"
              class="pia-questionBlock-contentText"
              [innerHTML]="breachForm.form.controls['recipients']?.value | safeHtml"
              [ngClass]="{ 'hide': ((editor && elementId === recipients.id) || !breachForm.form.controls['recipients']?.value) }"
            ></div>

            <textarea
              class="field"
              id="breach-recipients"
              required
              name="recipients"
              minRows="8"
              cols="50"
              placeholder="{{'breach.form.recipients.placeholder' | translate}}"
              #recipients
              (change)="updateBreach()"
              [(ngModel)]="breach.recipients"
              [ngClass]="{ 'hide': (breachForm.form.controls['recipients']?.value && breachForm.form.controls['recipients']?.value.length > 0) }"
              (focusin)="editField($event.target, ['PIA_LGL_ST', 'PIA_LGL_DEST'])"
            ></textarea>
          </div>
          <div class="form-field">
            <label class="title" for="breach-non-eu-transfer">{{ 'breach.form.non-eu-transfer.title' | translate }}</label>
            <div (click)="editField(nonEuTransfer, ['PIA_LGL_TRAN'])"
              class="pia-questionBlock-contentText"
              [innerHTML]="breachForm.form.controls['non-eu-transfer']?.value | safeHtml"
              [ngClass]="{ 'hide': ((editor && elementId === nonEuTransfer.id) || !breachForm.form.controls['non-eu-transfer']?.value) }"
            ></div>

            <textarea
              class="field"
              id="breach-non-eu-transfer"
              required
              name="non-eu-transfer"
              minRows="8"
              cols="50"
              placeholder="{{'breach.form.non-eu-transfer.placeholder' | translate}}"
              #nonEuTransfer
              (change)="updateBreach()"
              [(ngModel)]="breach.non_eu_transfer"
              [ngClass]="{ 'hide': (breachForm.form.controls['non-eu-transfer']?.value && breachForm.form.controls['non-eu-transfer']?.value.length > 0) }"
              (focusin)="editField($event.target, ['PIA_LGL_TRAN'])"
            ></textarea>
          </div>
      </fieldset>

      <div 
        class="form-field validate-container ready" 
        *ngIf="breach.status === breachStatus.STATUS_DOING"
      >
        <button 
          class="btn btn-green expanded"
          (click)="askValidation()"
        >
          {{ 'breach.form.ask_validate_button' | translate }}
        </button>
      </div>
    </form>
  </main>
</section>
