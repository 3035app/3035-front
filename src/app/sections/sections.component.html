<aside class="pia-leftSidebar">
    <div class="processing-sections">
        <div class="processing-section-header" *ngIf="processing">
            <h1 class="truncate" title="{{processing.name}}">{{ processing.name }}</h1>
            <a class="pia-icons pia-icon-close-big" routerLink="/folders/{{ processing?.folder.id }}"
                title="{{ 'processing?.sections.homepage_link' | translate }}"></a>
        </div>
    
        <div class="processing-section-body">
            <div id="context-section">
                <div class="processing-section-title">
                    {{ 'sections.1.title' | translate }}
                    <hr>
                </div>
                <ul class="processing-section-list">
                    <ng-container *ngFor="let section of processingSections; let i=index">
                        <li *ngIf="i < 2">
                            <a (click)="changeProcessingSection(section.id)" [ngClass]="{'active': currentProcessingSection.id == section.id}"
                                class="truncate">
                                {{ section.title | translate }}
                            </a>
                        </li>
                    </ng-container>
                </ul>
            </div>
            <div id="principles-section">
                <div class="processing-section-title">
                    {{ 'sections.2.title' | translate }}
                    <hr>
                </div>
                <ul class="processing-section-list">
                    <ng-container *ngFor="let section of processingSections; let i=index">
                        <li *ngIf="i > 1">
                            <a (click)="changeProcessingSection(section.id)" [ngClass]="{'active': currentProcessingSection.id == section.id}"
                                class="truncate">
                                {{ section.title | translate }}</a>
                        </li>
                    </ng-container>
                </ul>
            </div>
        </div>
    </div>
    <div class="pia-sectionsBlock">
        <div class="pia-sectionBlock-body">
            <ng-container *ngFor="let dataSection of data?.sections">
                <div *ngxPermissionsOnly="dataSection.permissions" id="{{dataSection.name}}">
    
                    <div class="pia-sectionBlock-title">
                        {{ dataSection.title | translate }}
                        <hr>
                    </div>
                    <ul class="pia-sectionBlock-list" *ngIf="processing?.pias_count > 0 && _piaService.pia?.id">
                        <ng-container *ngFor="let dataItem of dataSection?.items">
                            <li *ngIf="!dataItem.hide">
                                <a routerLink="/entry/{{_piaService.pia.id}}/section/{{dataSection.id}}/item/{{dataItem.id}}"
                                    [ngClass]="{'active': piaSection?.id == dataSection.id && piaItem?.id == dataItem.id}"
                                    class="truncate" *ngIf="dataSection.name !== 'validation-section' || !hasEditPermission || processing.status >= 4">
                                    {{ dataItem.title | translate }}</a>
                                <span [ngClass]="{'active': piaSection?.id == dataSection.id && piaItem?.id == dataItem.id}"
                                    class="truncate" *ngIf="dataSection.name === 'validation-section' && hasEditPermission && processing.status < 4">
                                    {{ dataItem.title | translate }}</span>
                                <i class="fa"
                                    *ngIf="_sidStatusService.sidStatusIcon[_sidStatusService.itemStatus[dataSection.id + '.' + dataItem.id]]"
                                    [ngClass]="_sidStatusService.sidStatusIcon[_sidStatusService.itemStatus[dataSection.id + '.' + dataItem.id]]"
                                    aria-hidden="true"></i>
                            </li>
                        </ng-container>
                    </ul>
                </div>
            </ng-container>
        </div>
    </div>
    
    <div class="pia-validatePIABlock" *ngIf="_piaService.pia">
        <ng-container *ngIf="_sidStatusService.enableDpoValidation || _sidStatusService.piaIsRefused; else defaultButton">
            <a routerLink="/entry/{{_piaService.pia.id}}/section/4/item/4" class="btn btn-green btn-active"
                *ngIf="_sidStatusService.enablePiaValidation">{{ 'pia.sections.validate_pia' | translate }}</a>
            <a routerLink="/entry/{{_piaService.pia.id}}/section/4/item/5" class="btn btn-red btn-active"
                *ngIf="_sidStatusService.piaIsRefused">{{ 'pia.sections.refuse_pia' | translate }}</a>
        </ng-container>
        <ng-template #defaultButton>
            <a *ngIf="_piaService.pia.type == 'advanced'" class="btn btn-inactive">{{ 'pia.sections.validate_pia' |
                translate }}</a>
        </ng-template>
    </div>
    <div class="pia-validatePIABlock">
        <a class="btn btn-active btn-green" (click)="openHistoryModal()">{{ 'pia.sections.history' | translate }}</a>
    </div>
    <app-processing-attachments [processing]="processing" *ngIf="processing"></app-processing-attachments>
    <!-- <app-attachments [pia]="_piaService.pia" *ngIf="_piaService.pia?.id"></app-attachments> -->
</aside>
